# Configuración optimizada para competición Taï Park Species Classification
# Diseñada para máxima precisión en el leaderboard

# Data settings
data:
  raw_dir: "data/raw"
  processed_dir: "data/processed"
  train_images_dir: "data/raw/train_features"
  test_images_dir: "data/raw/test_features"
  fraction: 1.0  # Usar todos los datos
  
# Model settings - EfficientNet B4 balance entre precisión y velocidad
model:
  name: "efficientnet_b4"
  num_classes: 8
  pretrained: true
  dropout: 0.4
  use_attention: true
  
# Training settings - Optimizado para competición
training:
  batch_size: 32
  num_epochs: 100
  learning_rate: 0.001
  weight_decay: 0.01
  optimizer: "adamw"  # AdamW mejor para fine-tuning
  validation_split: 0.2
  early_stopping_patience: 15  # Más paciencia para mejor convergencia
  gradient_clip: 1.0
  num_workers: 6
  sampler_type: "site_aware"  # Crítico: evitar data leakage
  
# Scheduler - Cosine annealing para mejor convergencia
scheduler:
  type: "cosine"
  T_max: 100  # Igualar num_epochs
  eta_min: 0.00001
  
# Image preprocessing
image:
  size: [384, 384]  # Resolución más alta para mejor precisión
  normalize:
    mean: [0.485, 0.456, 0.406]
    std: [0.229, 0.224, 0.225]
    
# Augmentation settings - Agresiva para más generalización
augmentation:
  aggressive: true
  horizontal_flip: 0.6
  vertical_flip: 0.1  # Conservadora para animales
  rotation: 20
  brightness: 0.3
  contrast: 0.3
  color_jitter: 0.4
  gaussian_blur: 0.1
  random_erasing: 0.2
  mixup_alpha: 0.2  # Mixup para regularización
  
# Loss function - Focal Loss para desbalance de clases
loss:
  type: "focal"
  focal_alpha: 1.0
  focal_gamma: 2.5  # Más agresivo para casos difíciles
  use_class_weights: true
  
# Hardware settings - Optimizado para GPU
hardware:
  device: "cuda"
  mixed_precision: true  # AMP para velocidad
  compile: true  # PyTorch 2.0 compile para velocidad extra
  deterministic: false  # Permitir optimizaciones no determinísticas
  num_workers: 6
  pin_memory: true
  
# Logging y monitoreo
logging:
  log_dir: "results/logs"
  tensorboard_dir: "results/logs/tensorboard"
  log_level: "INFO"
  save_frequency: 10  # Checkpoints menos frecuentes
  log_frequency: 50
  
# Weights & Biases (opcional)
wandb:
  project: "tai-park-competition"
  entity: null  # Configurar según tu cuenta
  tags: ["competition", "efficientnet_b4", "focal_loss"]
  
# Output settings
output:
  models_dir: "results/models"
  predictions_dir: "data/submissions"
  plots_dir: "results/plots"
  
# Freeze settings - Fine-tuning completo
freeze:
  freeze_backbone: false  # Entrenar todo el modelo
  unfreeze_layers: null
  
# Test Time Augmentation para submission final
tta:
  enabled: true
  num_transforms: 8
  horizontal_flip: true
  rotations: [0, 90, 180, 270]
  scales: [1.0, 1.1]
  
# Ensemble settings (para múltiples modelos)
ensemble:
  enabled: false
  models: []
  weights: []
  voting: "soft"  # soft voting con probabilidades